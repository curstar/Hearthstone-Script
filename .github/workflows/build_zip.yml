name: 编译并打包 Maven 项目 (Java 25)

on:
  push:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. 检出代码
    - name: Checkout Code
      uses: actions/checkout@v4
      with:
        submodules: recursive
        fetch-depth: 0

    # 2. 强制更新子仓库
    - name: Force Update Submodules
      run: |
        git submodule sync
        git submodule update --init --recursive --remote

    # 3. 设置 Java 25 环境 (这里改成了 25)
    # 注意：如果 Temurin 还没发布 25 的正式版，可能需要换成 zulu，先试这个
    - name: Set up JDK 25
      uses: actions/setup-java@v4
      with:
        java-version: '25'
        distribution: 'temurin' 
        cache: 'maven'

    # 4. 开始编译
    # -Dmaven.test.skip=true: 跳过测试
    - name: Build with Maven
      run: mvn -B package --file pom.xml -Dmaven.test.skip=true

    # 5. 上传结果
    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: Executable-Files
        path: |
          **/target/*.jar
          **/target/*.zip
          !**/target/original-*.jar
          !**/target/*-sources.jar
          !**/target/*-javadoc.jar
